"use strict";(self.webpackChunkdocsite=self.webpackChunkdocsite||[]).push([[782],{8327:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>h,contentTitle:()=>s,default:()=>a,frontMatter:()=>t,metadata:()=>c,toc:()=>d});var i=n(4848),r=n(8453);const t={},s="Configuring Webhooks",c={id:"webhooks",title:"Configuring Webhooks",description:"Multiple Komodo resources can take advantage of webhooks from your git provider. Komodo supports incoming webhooks using either the Github or Gitlab webhook authentication type, which is also supported by other providers like Gitea.",source:"@site/docs/webhooks.md",sourceDirName:".",slug:"/webhooks",permalink:"/docs/webhooks",draft:!1,unlisted:!1,editUrl:"https://github.com/mbecker20/komodo/tree/main/docsite/docs/webhooks.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Sync Resources",permalink:"/docs/sync-resources"},next:{title:"Version Upgrades",permalink:"/docs/version-upgrades"}},h={},d=[{value:"Copy the Webhook URL",id:"copy-the-webhook-url",level:2},{value:"Create the webhook on the Git Provider",id:"create-the-webhook-on-the-git-provider",level:2},{value:"When does it trigger?",id:"when-does-it-trigger",level:2}];function l(e){const o={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.header,{children:(0,i.jsx)(o.h1,{id:"configuring-webhooks",children:"Configuring Webhooks"})}),"\n",(0,i.jsx)(o.p,{children:"Multiple Komodo resources can take advantage of webhooks from your git provider. Komodo supports incoming webhooks using either the Github or Gitlab webhook authentication type, which is also supported by other providers like Gitea."}),"\n",(0,i.jsx)(o.admonition,{type:"note",children:(0,i.jsx)(o.p,{children:'On Gitea, the default "Gitea" webhook type works with the Github authentication type \ud83d\udc4d'})}),"\n",(0,i.jsx)(o.h2,{id:"copy-the-webhook-url",children:"Copy the Webhook URL"}),"\n",(0,i.jsxs)(o.p,{children:["Find the resource in UI, like a ",(0,i.jsx)(o.code,{children:"Build"}),", ",(0,i.jsx)(o.code,{children:"Repo"}),", or ",(0,i.jsx)(o.code,{children:"Stack"}),".\nGo to the ",(0,i.jsx)(o.code,{children:"Config"}),' section, find "Webhooks", and copy the webhook for the action you want.']}),"\n",(0,i.jsx)(o.p,{children:"The webhook URL is constructed as follows:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-shell",children:"https://${HOST}/listener/${AUTH_TYPE}/${RESOURCE_TYPE}/${ID_OR_NAME}/${EXECUTION}\n"})}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:(0,i.jsx)(o.code,{children:"HOST"})}),": Your Komodo endpoint to recieve webhooks.","\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["If your Komodo sits in a private network,\nyou will need a public proxy setup to forward ",(0,i.jsx)(o.code,{children:"/listener"})," requests to Komodo."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:(0,i.jsx)(o.code,{children:"AUTH_TYPE"})}),":","\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["options: ",(0,i.jsx)(o.code,{children:"github"})," | ",(0,i.jsx)(o.code,{children:"gitlab"})]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"github"}),": Validates the signature attached with ",(0,i.jsx)(o.code,{children:"X-Hub-Signature-256"}),". ",(0,i.jsx)(o.a,{href:"https://docs.github.com/en/webhooks/using-webhooks/validating-webhook-deliveries",children:"reference"})]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"gitlab"}),": Checks that the secret attached to ",(0,i.jsx)(o.code,{children:"X-Gitlab-Token"})," is valid. ",(0,i.jsx)(o.a,{href:"https://docs.gitlab.com/ee/user/project/integrations/webhooks.html#create-a-webhook",children:"reference"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:(0,i.jsx)(o.code,{children:"RESOURCE_TYPE"})}),":","\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["options: ",(0,i.jsx)(o.code,{children:"build"})," | ",(0,i.jsx)(o.code,{children:"repo"})," | ",(0,i.jsx)(o.code,{children:"stack"})," | ",(0,i.jsx)(o.code,{children:"sync"})," | ",(0,i.jsx)(o.code,{children:"procedure"})," | ",(0,i.jsx)(o.code,{children:"action"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:(0,i.jsx)(o.code,{children:"ID_OR_NAME"})}),":","\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"Reference the specific resource by id or name. If the name may change, it is better to use id."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:(0,i.jsx)(o.code,{children:"EXECUTION"})}),":","\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["Which executions are available depends on the ",(0,i.jsx)(o.code,{children:"RESOURCE_TYPE"}),". Builds only have the ",(0,i.jsx)(o.code,{children:"/build"})," action.\nRepos can select between ",(0,i.jsx)(o.code,{children:"/pull"}),", ",(0,i.jsx)(o.code,{children:"/clone"}),", or ",(0,i.jsx)(o.code,{children:"/build"}),". Stacks have ",(0,i.jsx)(o.code,{children:"/deploy"})," and ",(0,i.jsx)(o.code,{children:"/refresh"}),", and Resource Syncs have ",(0,i.jsx)(o.code,{children:"/sync"})," and ",(0,i.jsx)(o.code,{children:"/refresh"}),"."]}),"\n",(0,i.jsxs)(o.li,{children:["For ",(0,i.jsx)(o.strong,{children:"Procedures and Actions"}),", this will be the ",(0,i.jsx)(o.strong,{children:"branch to listen to for pushes"}),", or ",(0,i.jsx)(o.code,{children:"__ANY__"})," to trigger\non pushes to any branch."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(o.h2,{id:"create-the-webhook-on-the-git-provider",children:"Create the webhook on the Git Provider"}),"\n",(0,i.jsx)(o.p,{children:"Navigate to the repo page on your git provider, and go to the settings for the Repo.\nFind Webhook settings, and click to create a new webhook."}),"\n",(0,i.jsx)(o.p,{children:"You will have to input some information."}),"\n",(0,i.jsxs)(o.ol,{children:["\n",(0,i.jsxs)(o.li,{children:["The ",(0,i.jsx)(o.code,{children:"Payload URL"})," is the link that you copied in the step above, ",(0,i.jsx)(o.code,{children:"Copy the Resource Payload URL"}),"."]}),"\n",(0,i.jsxs)(o.li,{children:["For Content-type, choose ",(0,i.jsx)(o.code,{children:"application/json"})]}),"\n",(0,i.jsxs)(o.li,{children:["For Secret, input the secret you configured in the Komodo Core config (",(0,i.jsx)(o.code,{children:"KOMODO_WEBHOOK_SECRET"}),")."]}),"\n",(0,i.jsx)(o.li,{children:"Enable SSL Verification, if you have proper TLS setup to your git provider (recommended)."}),"\n",(0,i.jsx)(o.li,{children:'For "events that trigger the webhook", just the push request is what post people want.'}),"\n",(0,i.jsx)(o.li,{children:'Of course, make sure the webhook is "Active" and hit create.'}),"\n"]}),"\n",(0,i.jsx)(o.h2,{id:"when-does-it-trigger",children:"When does it trigger?"}),"\n",(0,i.jsxs)(o.p,{children:["Your git provider will now push this webhook to Komodo on ",(0,i.jsx)(o.em,{children:"every"})," push to ",(0,i.jsx)(o.em,{children:"any"})," branch. However, your ",(0,i.jsx)(o.code,{children:"Build"}),", ",(0,i.jsx)(o.code,{children:"Repo"}),",\netc. only cares about a specific branch of the repo."]}),"\n",(0,i.jsxs)(o.p,{children:["Because of this, the webhook will trigger the action ",(0,i.jsx)(o.strong,{children:"only on pushes to the branch configured on the resource"}),"."]}),"\n",(0,i.jsxs)(o.p,{children:["For example, if I make a build, I may point the build to the ",(0,i.jsx)(o.code,{children:"release"})," branch of a particular repo. If I set up a webhook, and push to the ",(0,i.jsx)(o.code,{children:"main"})," branch, the action will ",(0,i.jsx)(o.em,{children:"not trigger"}),". It will only trigger when the push is to the ",(0,i.jsx)(o.code,{children:"release"})," branch."]})]})}function a(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,i.jsx)(o,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,o,n)=>{n.d(o,{R:()=>s,x:()=>c});var i=n(6540);const r={},t=i.createContext(r);function s(e){const o=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function c(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(t.Provider,{value:o},e.children)}}}]);